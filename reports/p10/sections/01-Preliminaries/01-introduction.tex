\chapter{Introduction}\label{ch:introduction}
%\bibtodo{changed to reflect new work}
A \gls{manet} is a decentralised wireless network that requires no pre-existing infrastructure, such as
routers or access points~\cite{inproceedings:routingsurvery}. Instead, each node in the ad-hoc network are
battery powered and communicates directly with each other using a radio. Due to this, \gls{manet}s rely on
wireless networking protocols to provide energy efficient communication in the network. Because of the ad-hoc
nature of \gls{manet}s, common applications consist of enabling communication in emergencies such as
natural disasters, or for military conflicts.\smallbreak

% Outline the goal
The goal of this project is to simulate wireless network protocols for communication in a mobile setting.
Ideally, the capabilities of a wireless network protocol are tested in a real-life scenario, using physical
devices for radio communication. This poses interesting challenges such as scalability, and repeatability.
Scaling a real-life test requires a significant amount of effort and investment of both money and time, and
repeating the same test over and over becomes near impossible, the larger the scale. Our goal is to be able to
perform repeatable experiments in a controlled topology environment with up to 1000 devices.\smallbreak

Our project proposes a \gls{mpi} C++ library for writing, and running, simulations of the network protocol
behind the mesh communication in a \gls{manet}, modelling link \gls{pathloss} to simulate packet loss and
collisions caused by interfering transmitters, where the physical devices, and the communication between
these, are emulated entirely using software. With our library, it is be possible to write a C++ implementation
of communication protocols, such as \gls{lmac}~\cite{paper:lmac_protocol} or Slotted
ALOHA~\cite{Roberts:1975:APS:1024916.1024920}, using a simple interface header file resembling a traditional
hardware interface, and perform simulations with these, where each physical device is emulated by different
CPUs on the MCC compute cluster at AAU~\cite{website:mccaau}. \smallbreak

% Outline contributions
The primary contribution of this project is the Coordinator that facilitate wireless communication between the
emulated physical devices. The Coordinator allows us to simulate wireless communication in virtual time, where
the Coordinator can skip periods of inactivity, reducing the time required to run real-time
simulations. In addition to this, we propose a method for modelling and computing link \gls{pathloss} using
building footprints between nodes of a link, on OpenStreetMap map tiles obtained via the Mapbox Maps Service
API~\cite{website:mapbox}. Finally, we propose extensions to a network topology visualisation tool created by
Peter GjÃ¸l Jensen, in which we are now able to visualise communication and protocol logs, generated by running
simulations with our library.

\clearpage
\begin{figure}[H]
    %\caption{Processing an \textit{inform} action.}\label{tikz:coordinatormsc3}
    % Diagram

    \begin{tikzpicture}[node distance=.8cm,start chain=going below,]
        \node[punktchain,rounded corners] (fieldmeasurements) {Field Measurements};

        \begin{scope}[start branch=venstre,every join/.style={->, thick, shorten <=1pt}, ]
            \node[punktchain, on chain=going left,rounded corners] (generateddata) {Random Walk Generated Topologies};
        \end{scope}

        \node[punktchain] (linkmodel) {\textbf{Link Model}\\ \autoref{sec:linkmodel}};

        \begin{scope}[start branch=venstre,every join/.style={->, thick, shorten <=1pt}, ]
            \node[punktchain,rounded corners, on chain=going left, join=by {<-}] (gpslogs) {GPS Logs};
            \node[punktchain,rounded corners, on chain=going below] (hardware) {Radio Hardware\\Parameters};
            
        \end{scope}

        \begin{scope}[start branch=hoejre,]
            \node[punktchain,rounded corners, on chain=going right, join=by {->}] (gpslogs-rssi) {GPS Logs + RSSI};
            %\node[punktchain, on chain=going below, join] (radiomodel) {Radio Simulator\\ \autoref{sec:pep}};
            
            \node[punktchain, on chain=going below, opacity=0] (hidden-right0) {};
            \node[punktchain, on chain=going below, opacity=0] (hidden-right1) {};
            \node[punktchain,rounded corners, on chain=going below] (communication-log) {Communication Logs};
            \node[punktchain, on chain=going below, opacity=0] (hidden-right2) {};

            \node[punktchain,on chain=going below] (visualiser) {\textbf{Visualiser}\\ \autoref{sec:visualiser}};

            %\node[punktchain, on chain=going below, opacity=0] (hidden-right3) {};
            \node[punktchain, on chain=going below, opacity=0] (hidden-right4) {};
            \node[punktchain, minimum height=6em, on chain=going below, opacity=0] (hidden-right5) {};
            \node[punktchain,rounded corners, on chain=going below] (protocol-log) {Protocol Log};
        \end{scope}

        \node[right=of visualiser] (visualiser-point) {};

        \node[punktchain] (radiomodel) {\textbf{Radio Simulator}\\ \autoref{sec:pep}};
        \node[punktchain, opacity=0] (hidden1) {};
        \node[punktchain] (coordinator) {\textbf{Coordinator}\\ \autoref{sec:coordinator}};
        \node[punktchain, opacity=0] (hidden2) {};
        \node[punktchain] (radio-middleware) {\textbf{Radio Middleware}\\ \autoref{sec:interface}};
        \node[punktchain, opacity=0] (hidden3) {};
        \node[punktchain, minimum height=6em, minimum width=20em] (executable-code) {Executable Code\\ \ \\ \ \\ \ \\};
        \node[below left=-0.3cm and 2.05cm of executable-code.center, rectangle, draw=black, very thick, minimum height=3em, minimum width=3em] (node1) {\Node{1}};
        \node[below left=-0.3cm and 0cm of executable-code.center, rectangle, draw=black, very thick, minimum height=3em, minimum width=3em] (node2) {\Node{2}};
        \node[below right=-0.3cm and 2.05cm of executable-code.center, rectangle, draw=black, very thick, minimum height=3em, minimum width=3em] (noden) {\Node{$n$}};
        \node[between=node2 and noden] (nodedots) {\dots};
        %\node[punktchain, opacity=0] (hidden4) {};
        \node[punktchain] (protocol-code) {\textbf{Protocol Impl.}\\ \autoref{sec:lmacc}};
        %\node[punktchain] (visualiser) {Visualiser\\ \autoref{sec:visualiser}};

        
        \draw[|-,-|,-, thick,] (gpslogs-rssi.east) |-+(0,0)-| (visualiser-point.center);
        \draw[|-,-|,-, thick,] (communication-log.east) |-+(0,0)-| (visualiser-point.center);
        \draw[|-,-|,-, thick,] (protocol-log.east) |-+(0,0)-| (visualiser-point.center);


        \draw[|-,-|,<-, thick,] (linkmodel.south) |-+(0,-1em)-| (hardware.north);
        \draw[|-,-|,->, thick,] (hardware.east) to (radiomodel.west);
        \draw[|-,-|,->, thick,] (generateddata.south) |-+(0,-1em)-| (gpslogs.north);
        \draw[|-,-|,->, thick,] (fieldmeasurements.south) |-+(0,-1em)-| (gpslogs.north);
        \draw[|-,-|,->, thick,] (fieldmeasurements.south) |-+(0,-1em)-| (gpslogs-rssi.north);

        \draw[|-,-|,->, thick, transform canvas={xshift=-1.3cm}] (radiomodel.south) to (coordinator.north) node[align=right,above left=0.8cm and 0.5cm] {Probability for\\packet error $p$};
        \draw[|-,-|,<-, thick, transform canvas={xshift=1.3cm}] (radiomodel.south) to (coordinator.north) node[align=left,above right=0.9cm and 0.5cm] {$P_p(n_r, m_t, \mathit{nodes}_i, \mathit{packetsize}, t)$};

        \draw[|-,-|,->, thick, transform canvas={xshift=-1.3cm}] (coordinator.south) to (radio-middleware.north) node[align=right,above left=0.8cm and 0.5cm] {Received \\ packets};
        \draw[|-,-|,<-, thick, transform canvas={xshift=1.3cm}] (coordinator.south) to (radio-middleware.north) node[align=left,above right=0.4cm and 0.5cm] {Transmit\\Listen\\Sleep\\Inform};


        \draw[|-,-|,->, thick, transform canvas={xshift=-1.3cm}] (radio-middleware.south) to (executable-code.north) node[align=right,above left=0.8cm and 0.5cm] {Received \\ packets};
        \draw[|-,-|,<-, thick, transform canvas={xshift=1.3cm}] (radio-middleware.south) to (executable-code.north) node[align=left,above right=0.4cm and 0.5cm] {2-Phase Broadcast\\2-Phase Receive\\Sleep\\Inform};

        \draw[|-,-|,->, thick,] (protocol-code) to (executable-code);
        \draw[|-,-|,->, thick,] (coordinator) to (communication-log);
        \draw[|-,-|,->, thick,] (protocol-code) to (protocol-log);
        \draw[|-,-|,->, thick,] (visualiser-point.center) to (visualiser);

    \end{tikzpicture}
    %\caption{TODO}\label{fig:introfigure}
\end{figure}

\clearpage